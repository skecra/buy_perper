<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perper ‚Äî Buy / Domains / Host</title>
  <link rel="stylesheet" href="../css/index.css"/>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">PERPER</div>
      <ul class="nav-links">
        <li><a href="#">Home</a></li>
        <li><a href="../pages/domain.html">Domains</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
      <div class="hamburger"><span></span><span></span><span></span></div>
    </nav>
  </header>

  <main class="container">
    <div class="content-section">
      <h1>Buy <span>Perper</span> Token</h1>
      <p>Purchase the Perper token securely and easily.</p>
      <button onclick="connectWallet()" class="buy-btn">Connect with MetaMask</button>
    </div>

    <div class="coin-container">
      <div class="coin-glow"></div>
      <img src="../assets/images/coin.png" alt="Perper Coin" class="coin-image"/>
    </div>
  </main>

  <div class="section-divider">
    <svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path fill="#ff6600" fill-opacity="0.4"
        d="M0,160L48,165.3C96,171,192,181,288,170.7C384,160,480,128,576,133.3C672,139,768,181,864,208C960,235,1056,245,1152,224C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320L1344,320L1248,320L1152,320L1056,320L960,320L864,320L768,320L672,320L576,320L480,320L384,320L288,320L192,320L96,320L0,320Z">
      </path>
    </svg>
  </div>

  <!-- ============ GLASS CARD ============ -->
  <section class="token-actions">
    <div class="glass-card">
      <!-- Tabs -->
      <div class="card-tabs">
        <button id="tabPerper" class="card-tab active" data-target="perper">Buy Perper</button>
        <button id="tabDomain" class="card-tab" data-target="domain">Buy Domain</button>
        <button id="tabHost" class="card-tab" data-target="host">Host Website</button>
        <span class="card-tab-indicator" id="tabIndicator"></span>
      </div>

      <!-- 3D flip: FRONT=Perper, BACK=Domain/Host (isti flip, mijenja se panel) -->
      <div class="card-3d" id="flipCard">
        <!-- FRONT (Perper) -->
        <div class="card-face card-front">
          <div class="tab-menu">
            <button class="tab-btn active" data-tab="buy">Buy</button>
            <button class="tab-btn" data-tab="transfer">Transfer</button>
            <button class="tab-btn" data-tab="history">History</button>
            <button class="tab-btn" data-tab="wallet">Wallet</button>
          </div>

          <div class="tab-content">
            <!-- Buy -->
            <div class="tab-panel active" id="buy">
              <h2>Buy PRP</h2>
              <form id="buy-form">
                <label>Amount (PRP):</label>
                <input type="number" id="buy-amount" step="0.01" placeholder="Enter amount"/>
                <label>Pay (ETH):</label>
                <input type="number" id="buy-eth" step="0.000001" placeholder="Auto-calculated"/>
                <button type="submit">Buy Tokens</button>
              </form>
            </div>

            <!-- Transfer -->
            <div class="tab-panel" id="transfer">
              <h2>Transfer PRP</h2>
              <form id="transfer-form">
                <label>Recipient:</label>
                <input type="text" id="recipient" placeholder="0x..."/>
                <label>Amount (PPR):</label>
                <input type="number" id="amount" placeholder="Enter amount"/>
                <button type="submit">Send</button>
              </form>
            </div>

            <!-- History -->
            <div class="tab-panel" id="history">
              <h2>Transaction History</h2>
              <ul id="history-list"></ul>
            </div>

            <!-- Wallet -->
            <div class="tab-panel" id="wallet">
              <h2>Your Wallet</h2>
              <p id="wallet-address">Wallet: Not connected</p>
              <p id="token-balance">Balance: 0 PRP</p>
              <button class="connect-button" onclick="connectWallet()">Connect with Metamask</button>
            </div>
          </div>
        </div>

        <!-- BACK (Domain OR Host ‚Äî isti flip, biramo panel) -->
        <div class="card-face card-back">
          <!-- DOMAIN BACK PANEL -->
          <div id="back-domain" class="back-panel" style="display:block;">
            <h2>Register Domain</h2>
            <form id="domain-form">
              <label>Domain name:</label>

              <div class="input-with-icon">
                <input type="text" id="domain-name" placeholder="example.perper"/>
                <button type="button" id="btnCheckPrice" class="icon-btn" title="Check price" aria-label="Check price">üîç</button>
              </div>

              <label>Pay with (PRP):</label>
              <input type="text" id="domain-price" placeholder="Calculated total" disabled/>
              <button type="submit">Register</button>
            </form>


            <p class="hint">You need PRP tokens to register a domain.</p>
          </div>

          <!-- HOST BACK PANEL (PINATA) -->
          <div id="back-host" class="back-panel" style="display:none;">
            <h2>Host Your Website (IPFS via Pinata)</h2>
            <form id="pinata-form">
              <label>Select website folder (must include index.html)</label>
              <input id="pinataFolder" type="file" webkitdirectory multiple />
              <div class="upload-progress pinata" style="display:none;">
                <progress value="0" max="100"></progress>
                <span class="status">Preparing...</span>
              </div>
              <button type="submit" id="pinataUploadBtn">Upload to Pinata</button>
            </form>

            <div class="host-result" id="pinataResult" style="display:none;">
              <p><strong>Root CID:</strong> <span id="pinataCid"></span></p>
              <p><strong>Gateway URL:</strong>
                <a id="pinataUrl" href="#" target="_blank" rel="noopener">open via ipfs.io</a>
              </p>
              <p style="font-size:0.95em;opacity:.8;">
                Alternative: <a id="pinataUrlDweb" href="#" target="_blank" rel="noopener">dweb.link</a>
              </p>
            </div>

            <div class="host-files">
              <h3>Selected Files</h3>
              <ul id="pinataFiles"></ul>
            </div>

            <!-- NOVO: Moji Pinata pinovi (listanje + delete) -->
            <hr style="margin:16px 0; opacity:.35;">
            <h3>My IPFS uploads (Pinata)</h3>
            <div class="myfiles-controls" style="display:flex; gap:8px; align-items:center; margin-top:6px;">
              <input id="pinFilter" type="text" placeholder="filter by name (optional)" style="flex:1;">
              <button id="btnRefreshPins" type="button">Refresh</button>
            </div>
            <ul id="pinList" class="host-files" style="margin-top:10px;"></ul>
            <p class="hint">‚ÄúDelete‚Äù uklanja pin iz tvog naloga (sadr≈æaj mo≈æe ostati dostupan ako ga pin-uje neko drugi na IPFS mre≈æi).</p>
            <!-- /NOVO -->
          </div>
        </div>
      </div><!-- /card-3d -->
    </div>
  </section>

  <!-- inner tabs (front card) -->
  <script>
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabPanels  = document.querySelectorAll('.tab-panel');
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.getAttribute('data-tab');
        tabPanels.forEach(p => p.classList.toggle('active', p.id === target));
      });
    });

    const hamburger = document.querySelector('.hamburger');
    const navLinks  = document.querySelector('.nav-links');
    hamburger.addEventListener('click', () => {
      navLinks.classList.toggle('active');
      hamburger.classList.toggle('open');
    });
  </script>

  <script src="../js/app.js"></script>
</body>
</html>
